{% extends './components/base.html' %}

{% block head %}
<title>ReeLiz - Admin Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/auth.css') }}">
<style>
  .table-container {
    max-height: 400px;
    overflow-y: auto;
  }
  
  .table {
    margin-bottom: 0;
  }
  
  .table thead th {
    position: sticky;
    top: 0;
    background-color: #212529;
    color: white;
    z-index: 1;
  }
  
  .table tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  .btn-action {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
  }
  
  .card {
    border-radius: 0.5rem !important;
  }
  
  .admin-header {
    background-color: #212529;
    color: white;
    padding: 1rem;
    border-radius: 0.5rem 0.5rem 0 0;
  }
  
  .search-box {
    max-width: 300px;
  }
  
  .modal-header {
    background-color: #212529;
    color: white;
  }
  
  .modal-header .btn-close {
    filter: invert(1);
  }
</style>
{% endblock %}

{% block body %}
<div class="container py-5">
  <div class="row justify-content-center align-items-start min-vh-100 g-0">
    
    <!-- Admin Dashboard Container -->
    <div class="col-12 col-lg-10">
      <div class="card shadow-lg">
        <!-- Tabs on top -->
        <ul class="nav nav-tabs nav-fill" id="adminTabs" role="tablist" style="margin-bottom: 0;">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button"
              role="tab" aria-controls="profile" aria-selected="true">
              <i class="fa-solid fa-users me-1"></i> Profile
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="transaction-tab" data-bs-toggle="tab" data-bs-target="#transaction" type="button"
              role="tab" aria-controls="transaction" aria-selected="false">
              <i class="fa-solid fa-receipt me-1"></i> Transaction
            </button>
          </li>
        </ul>

        <div class="card-body px-4 pb-4 pt-3">
          <!-- Dashboard Title -->
          <div class="text-center mb-4">
            <h2 class="fw-bold mb-1">Admin Dashboard</h2>
            <p class="text-muted">Manage users and transactions</p>
          </div>

          <!-- Tabs Content -->
          <div class="tab-content" id="adminTabsContent">
            
            <!-- Profile (Users) Tab -->
            <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0"><i class="fa-solid fa-user-group me-2"></i>Users Management</h5>
                <div class="d-flex gap-2">
                  <input type="text" class="form-control search-box" id="userSearch" placeholder="Search users...">
                  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    <i class="fa-solid fa-plus me-1"></i> Add User
                  </button>
                </div>
              </div>
              
              <div class="table-container">
                <table class="table table-striped table-hover" id="usersTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Username</th>
                      <th>Email</th>
                      <th>Created At</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="usersTableBody">
                    <!-- Data will be loaded dynamically -->
                  </tbody>
                </table>
              </div>
              <div id="usersLoading" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>

            <!-- Transaction Tab -->
            <div class="tab-pane fade" id="transaction" role="tabpanel" aria-labelledby="transaction-tab">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0"><i class="fa-solid fa-money-bill-transfer me-2"></i>Transactions Management</h5>
                <div class="d-flex gap-2">
                  <input type="text" class="form-control search-box" id="transactionSearch" placeholder="Search transactions...">
                  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTransactionModal">
                    <i class="fa-solid fa-plus me-1"></i> Add Transaction
                  </button>
                </div>
              </div>
              
              <div class="table-container">
                <table class="table table-striped table-hover" id="transactionsTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Date</th>
                      <th>Name</th>
                      <th>Room</th>
                      <th>Movie</th>
                      <th>Seats</th>
                      <th>Amount</th>
                      <th>Barcode</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="transactionsTableBody">
                    <!-- Data will be loaded dynamically -->
                  </tbody>
                </table>
              </div>
              <div id="transactionsLoading" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
          </div>

          <div class="text-center mt-4">
            <a href="{{ url_for('landing') }}" class="btn btn-link text-decoration-none">
              <i class="fa-solid fa-arrow-left me-1"></i> Back to Home
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel"><i class="fa-solid fa-user-plus me-2"></i>Add New User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addUserForm">
          <div class="mb-3">
            <label for="newUsername" class="form-label">Username</label>
            <input type="text" class="form-control" id="newUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label for="newEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="newEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="newPassword" class="form-label">Password</label>
            <input type="password" class="form-control" id="newPassword" name="password" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveUserBtn">Save User</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editUserModalLabel"><i class="fa-solid fa-user-pen me-2"></i>Edit User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editUserForm">
          <input type="hidden" id="editUserId" name="id">
          <div class="mb-3">
            <label for="editUsername" class="form-label">Username</label>
            <input type="text" class="form-control" id="editUsername" name="username" required>
          </div>
          <div class="mb-3">
            <label for="editEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="editEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="editPassword" class="form-label">New Password (leave blank to keep current)</label>
            <input type="password" class="form-control" id="editPassword" name="password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="updateUserBtn">Update User</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete User Confirmation Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteUserModalLabel"><i class="fa-solid fa-trash me-2"></i>Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete user <strong id="deleteUserName"></strong>?</p>
        <p class="text-muted small">This action cannot be undone.</p>
        <input type="hidden" id="deleteUserId">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Transaction Modal -->
<div class="modal fade" id="addTransactionModal" tabindex="-1" aria-labelledby="addTransactionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addTransactionModalLabel"><i class="fa-solid fa-plus me-2"></i>Add New Transaction</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addTransactionForm">
          <div class="mb-3">
            <label for="newTransDate" class="form-label">Date</label>
            <input type="text" class="form-control" id="newTransDate" name="date" placeholder="MM/DD:HH" required>
          </div>
          <div class="mb-3">
            <label for="newTransName" class="form-label">Customer Name</label>
            <input type="text" class="form-control" id="newTransName" name="name" required>
          </div>
          <div class="mb-3">
            <label for="newTransRoom" class="form-label">Room</label>
            <input type="text" class="form-control" id="newTransRoom" name="room" required>
          </div>
          <div class="mb-3">
            <label for="newTransMovie" class="form-label">Movie</label>
            <input type="text" class="form-control" id="newTransMovie" name="movie" required>
          </div>
          <div class="mb-3">
            <label for="newTransSeats" class="form-label">Seats</label>
            <input type="text" class="form-control" id="newTransSeats" name="sits" placeholder="A1, A2, B3" required>
          </div>
          <div class="mb-3">
            <label for="newTransAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="newTransAmount" name="amount" required>
          </div>
          <div class="mb-3">
            <label for="newTransBarcode" class="form-label">Barcode</label>
            <input type="text" class="form-control" id="newTransBarcode" name="barcode" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveTransactionBtn">Save Transaction</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Transaction Modal -->
<div class="modal fade" id="editTransactionModal" tabindex="-1" aria-labelledby="editTransactionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editTransactionModalLabel"><i class="fa-solid fa-pen me-2"></i>Edit Transaction</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editTransactionForm">
          <input type="hidden" id="editTransId" name="id">
          <div class="mb-3">
            <label for="editTransDate" class="form-label">Date</label>
            <input type="text" class="form-control" id="editTransDate" name="date" placeholder="MM/DD:HH" required>
          </div>
          <div class="mb-3">
            <label for="editTransName" class="form-label">Customer Name</label>
            <input type="text" class="form-control" id="editTransName" name="name" required>
          </div>
          <div class="mb-3">
            <label for="editTransRoom" class="form-label">Room</label>
            <input type="text" class="form-control" id="editTransRoom" name="room" required>
          </div>
          <div class="mb-3">
            <label for="editTransMovie" class="form-label">Movie</label>
            <input type="text" class="form-control" id="editTransMovie" name="movie" required>
          </div>
          <div class="mb-3">
            <label for="editTransSeats" class="form-label">Seats</label>
            <input type="text" class="form-control" id="editTransSeats" name="sits" placeholder="A1, A2, B3" required>
          </div>
          <div class="mb-3">
            <label for="editTransAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="editTransAmount" name="amount" required>
          </div>
          <div class="mb-3">
            <label for="editTransBarcode" class="form-label">Barcode</label>
            <input type="text" class="form-control" id="editTransBarcode" name="barcode" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="updateTransactionBtn">Update Transaction</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Transaction Confirmation Modal -->
<div class="modal fade" id="deleteTransactionModal" tabindex="-1" aria-labelledby="deleteTransactionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteTransactionModalLabel"><i class="fa-solid fa-trash me-2"></i>Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete transaction <strong id="deleteTransId"></strong>?</p>
        <p class="text-muted small">This action cannot be undone.</p>
        <input type="hidden" id="deleteTransactionId">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteTransactionBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Alert Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="adminToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto" id="toastTitle">Notification</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" id="toastMessage">
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/services/admin.js') }}"></script>
{% endblock %}
