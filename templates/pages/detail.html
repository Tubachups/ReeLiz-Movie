{% extends './components/base.html' %}

{% block head %} <title>Movie Preview - Reeliz </title>
<link rel="icon" type="image/png" href="{{ url_for('static', filename='styles/img/logo3.png') }}">
<link rel="stylesheet" href="{{ url_for( 'static', filename='styles/detail.css')}}" />
<link rel="stylesheet" href="{{ url_for( 'static', filename='styles/layout-seat.css')}}" />
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=shopping_cart" />
{% endblock %}

{% block body %}
<!-- Hidden element to check auth status -->
<div id="userAuthStatus" data-authenticated="{% if username %}true{% else %}false{% endif %}" style="display: none;"></div>

<!-- Hidden element to store movie schedule -->
<div id="movieSchedule" 
     data-allowed-weekdays="{% if schedule %}{{ schedule.allowed_weekdays | join(',') }}{% endif %}"
     data-time-slots="{% if schedule %}{{ schedule.time_slots | join(',') }}{% endif %}"
     style="display: none;"></div>

<!-- Movie Detail Section -->
<section class="movie-detail py-5 d-flex align-items-center min-vh-100 overflow-hidden position-relative"
  style="--poster-url: url('https://image.tmdb.org/t/p/original{{ movie.poster_path }}');">
  <div class="movie-overlay position-absolute z-1 bg-dark bg-opacity-75" style="inset: 0;"></div>
  <div class="container position-relative z-3">
    <div class="row align-items-center g-5">
      <div class="col-md col-lg-4 col-xl-3 collgfadeInUp d-flex justify-content-center">
        <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}"
          class="thumbnail rounded shadow" />
      </div>
      <div class="col-md fadeInUp text-light">
        <h1 class="mb-4">{{ movie.title }}</h1>
        <div class="movie-info">
          <p><strong>Release Date:</strong> {{ movie.release_date }}</p>
          <p><strong>Runtime:</strong> {{ movie.runtime }} mins</p>
          <p>
            <strong>Genres:</strong>
            {% for genre in movie.genres %}
            {{ genre.name }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </p>
          <p class="mt-3">{{ movie.overview }}</p>
        </div>

        <!-- Ratings and Credits Section that I can't fucking fix -->
        <div class="movie-extra mt-4">
          <p><strong>TMDB Rating:</strong> ‚≠ê {{ movie.vote_average }}/10</p>
          <p><strong>Age Rating:</strong> {{ certification }}</p>
          <p><strong>Cast:</strong> {{ cast | join(', ') }}</p>
          <p><strong>Director:</strong> {{ directors | join(', ') if directors else 'N/A' }}</p>
          <p><strong>Producers:</strong> {{ producers | join(', ') if producers else 'N/A' }}</p>
          <p><strong>Writers:</strong> {{ writers | join(', ') if writers else 'N/A' }}</p>
        </div>

          <button id="bookNowBtn" class="btn {% if is_now_showing %}btn-primary{% else %}btn-secondary{% endif %} mt-1 rounded-3" {% if not is_now_showing %}disabled{% endif %}>
            <span class="btn-text">{% if is_now_showing %}Book Now{% else %}Coming Soon{% endif %}</span>
            <i class="fa-solid fa-calendar-days btn-icon"></i>
          </button>
      </div>
    </div>
  </div>
</section>


{% include "./components/booking.html" %}

<!-- Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title d-flex align-items-center gap-2" id="paymentModalLabel">
          <span class="material-symbols-outlined">shopping_cart</span>
          Payment Confirmation
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        Would you like to proceed to payment?
      </div>

      <div class="modal-footer border-0 d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-primary" id="paymentModalProceedBtn">Proceed</button>
        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Sign In Required Modal -->
<div class="modal fade" id="signInRequiredModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title d-flex align-items-center gap-2" id="signInRequiredModalLabel">
          Log In Required
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <h5 class="mb-3">You need to log in to continue with your booking.</h5>
        <h3 class="text-muted small">Please log in or create an account to proceed to checkout.</h3>
      </div>

      <div class="modal-footer border-0 d-flex justify-content-center gap-3">
        <a href="{{ url_for('login') }}" class="btn btn-primary">
          <i class="fa-solid fa-right-to-bracket me-2"></i>log In
        </a>
        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
 
<!-- Payment Method Modal (Bank / GCash) -->
<div class="modal fade" id="paymentMethodModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title d-flex align-items-center gap-2" id="paymentMethodModalLabel">
          <span class="material-symbols-outlined"></span>
          Choose Payment Method
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <p>Please select a payment method:</p>
        <div class="d-flex gap-3 justify-content-center align-items-center flex-wrap">
          <button type="button" class="payment-option btn p-2 bg-transparent" data-method="bank" aria-pressed="false">
            <img src="{{ url_for('static', filename='styles/img/bank.png') }}" alt="Bank" class="img-fluid" style="max-width:60px;" />
            <div class="mt-2">Bank</div>
          </button>

          <button type="button" class="payment-option btn p-2 bg-transparent" data-method="gcash" aria-pressed="false">
            <img src="{{ url_for('static', filename='styles/img/Gcashlogo.png') }}" alt="GCash" class="img-fluid" style="max-width:60px;" />
            <div class="mt-2">GCash</div>
          </button>
        </div>
      </div>

      <div class="modal-footer border-0 d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-primary" id="confirmPaymentBtn" disabled>Confirm Payment</button>
        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal with Animation -->
<div class="modal fade" id="successModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center py-5">
        <div class="success-checkmark mb-4">
          <div class="check-icon">
            <span class="icon-line line-tip"></span>
            <span class="icon-line line-long"></span>
            <div class="icon-circle"></div>
            <div class="icon-fix"></div>
          </div>
        </div>
        <h3 class="text-success mb-3">Payment Successful!</h3>
        <p class="text-muted mb-4">Your booking has been confirmed.</p>
        <p class="small">Barcode: <strong id="transactionBarcode"></strong></p>
        <p class="small">You will receive a invoice email shortly.</p>
      </div>
      <div class="modal-footer border-0 d-flex justify-content-center">
        <button type="button" class="btn btn-success px-5" data-bs-dismiss="modal">Done</button>
      </div>
    </div>
  </div>
</div>

<!-- Transaction Failed Modal -->
<div class="modal fade" id="transactionFailedModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0 bg-danger text-white">
        <h5 class="modal-title d-flex align-items-center gap-2" id="transactionFailedModalLabel">
          <i class="fa-solid fa-circle-exclamation"></i>
          Transaction Failed
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center py-4">
        <div class="mb-4">
          <i class="fa-solid fa-triangle-exclamation text-danger" style="font-size: 4rem;"></i>
        </div>
        <h4 class="text-danger mb-3">Transaction Could Not Be Completed</h4>
        <p class="text-muted mb-2">We encountered an error while processing your transaction.</p>
        <p class="text-muted small" id="transactionErrorMessage">Please try again or contact support if the issue persists.</p>
      </div>

      <div class="modal-footer border-0 d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Try Again</button>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script type="module" src="{{ url_for('static', filename='js/components/detail.js') }}"></script>

{% endblock %}